/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function closeUI(){Browser.sendToExtension({name:"bounce",message:{name:"closeClipper",notClipping:!0}})}function initData(a,b,c){title.value=a.title.substr(0,EDAM_NOTE_TITLE_LEN_MAX),recommendations.text=a.recommendationText,recommendations.url=a.url,pendingNoteKey=a.pendingNoteKey,c&&"function"==typeof c&&c(),initView()}function initView(){GlobalUtils.localize(document.body),title.placeholder=Browser.i18n.getMessage("quickNote_untitledNote"),comments.placeholder=Browser.i18n.getMessage("quickNote_addComment"),EDGE&&(screenshot.style.display="none",pdf.style.display="none",main.style["background-clip"]="border-box");for(var a=document.querySelectorAll("#clip h2"),b=0;b<a.length;b++)a.item(b).addEventListener("click",function(a){handleClipperToolClick(a.target)});platform.channel.sendMessage("getClipAction").then(function(a){var b=new RegExp("(?:"+document.body.className.replace(/\s+/,"|")+")");document.body.classList.contains("remember")?handleClipperToolClick(article):document.body.classList.contains("selection")?handleClipperToolClick(selection):document.body.classList.contains("email")?handleClipperToolClick(email):document.body.classList.contains("custom")?handleClipperToolClick(custom):b.test(pdf.className)?handleClipperToolClick(pdf):"ARTICLE"==a&&b.test(article.className)?handleClipperToolClick(article):"CLEARLY"==a&&b.test(clearly.className)?handleClipperToolClick(clearly):"FULL_PAGE"==a&&b.test(fullPage.className)?handleClipperToolClick(fullPage):"URL"==a&&b.test(url.className)?handleClipperToolClick(url):b.test(article.className)?handleClipperToolClick(article):b.test(fullPage.className)?handleClipperToolClick(fullPage):b.test(url.className)&&handleClipperToolClick(url)}).catch(function(a){log.error(a)}),title.addEventListener("input",function(){title.value=title.value.replace(/[\n\r]/g,""),title.rows="1",title.scrollHeight>title.clientHeight&&(title.rows="2"),setHeight()}),title.addEventListener("blur",function(){title.scrollTop=0}),FIREFOX&&title.addEventListener("focus",function(){main.classList.contains("minified")&&toggleMinimizeClipper()}),title.maxLength=EDAM_NOTE_TITLE_LEN_MAX,accountSelector=new AccountSelector({globalContainer:main,fieldContainer:accountSelectorElt,changeCallback:function(a,b){saveEnabled=!1,setHeight(),notebookSelector.setLoadingStatus(!0),platform.channel.sendMessage("setSelectedAccount",{selectedAccount:a,selectedSubpart:b}).then(function(){accountSelector.accountRequiresAuth(a,b)||isCurrentAccount(a,b)&&onUserChange()}).catch(function(a){log.error(a),refreshUI()})},signInCallback:performSignIn}),notebookSelector=new NotebookSelector({container:notebook,dropdownToggleCallback:setHeight,refreshNotebooksCallback:function(){var a=accountSelector.getSelectedAccount(),b=a.userInfo.userId+a.selectedSubpart;accountDataCache[b]||(accountDataCache[b]={}),accountDataCache[b].selectedNotebook=notebookSelector.getSelectedNotebook(),refreshNotebooks(a,{},!1)},createNotebookCallback:createNotebook,selectNotebookCallback:updateTagsInput}),requestAccounts(),tagSelector=new TagSelector(tags,setHeight,setHeight),comments.addEventListener("input",function(){comments.rows="1",comments.scrollHeight>comments.clientHeight&&(comments.rows="2"),setHeight()}),comments.addEventListener("blur",function(){comments.scrollTop=0}),FIREFOX&&comments.addEventListener("focus",function(){setHeight()}),initSkitch(),closeSidebar.addEventListener("click",function(a){a.stopPropagation(),closeUI()}),minimizeButton.addEventListener("click",function(a){a.stopPropagation(),toggleMinimizeClipper()}),saveButton.addEventListener("click",save),settings.addEventListener("click",function(){Browser.sendToExtension({name:"bounce",message:{name:"showOptions"}})}),window.addEventListener("keydown",function(a){9===a.keyCode&&notebookSelector.contains(document.activeElement)&&notebookSelector.close()}),main.addEventListener("click",function(){notebookSelector.closeNewNotebookBlock(),main.classList.contains("minified")&&toggleMinimizeClipper(),notebookSelector.isOpened()&&notebookSelector.close(),!handleSkitchTool&&shapesSubtools.classList.contains("open")?shapesSubtools.classList.remove("open"):!handleSkitchTool&&stampsSubtools.classList.contains("open")?stampsSubtools.classList.remove("open"):!handleSkitchTool&&colorsSubtools.classList.contains("open")&&colorsSubtools.classList.remove("open"),handleSkitchTool=!1}),setHeight()}function requestAccounts(){platform.channel.sendMessage("getAccountsData").then(function(a){if(accountSelector.setData(a.list,{selectedAccountId:a.selectedAccount,selectedSubpart:a.selectedSubpart}),1===Object.keys(a.list).length){var b=a.list[Object.keys(a.list)[0]].accountType;if(b!==GlobalUtils.ACCOUNT_TYPE_BUSINESS){var c=b===GlobalUtils.ACCOUNT_TYPE_PERSONAL?"addBusinessAccount":"addPersonalAccount";accountSelector.addOption({header:chrome.i18n.getMessage(c),callback:function(){platform.channel.sendMessage("openSignIn",{multiAuth:!0,type:b}).then(requestAccounts)}})}}})}function initSkitch(){for(var a=document.getElementsByClassName("skitchTool"),b=0;b<a.length;b++)a[b].addEventListener("click",handleSkitchToolClick),"highlighter"==a[b].id?a[b].title=Browser.i18n.getMessage("imageHighlighter"):"shapes"==a[b].id?a[b].title=Browser.i18n.getMessage("shapeTool"):"marker"==a[b].id?a[b].title=Browser.i18n.getMessage("markerTool"):"crop"==a[b].id?a[b].title=Browser.i18n.getMessage("crop"):"zoomout"==a[b].id?a[b].title=Browser.i18n.getMessage("zoomout"):"stamps"==a[b].id?a[b].title=Browser.i18n.getMessage("stampTool"):"text"==a[b].id?a[b].title=Browser.i18n.getMessage("typeTool"):"pixelate"==a[b].id?a[b].title=Browser.i18n.getMessage("pixelatorTool"):"colors"==a[b].id?a[b].title=Browser.i18n.getMessage("colors"):"zoomin"==a[b].id&&(a[b].title=Browser.i18n.getMessage("zoomin"));for(var c=document.getElementsByClassName("subtool"),b=0;b<c.length;b++)c[b].addEventListener("click",handleSubtoolClick);cancelScreenshotButton.addEventListener("click",function(){toggleMinimizeButtonVisibility("show"),document.body.classList.remove("skitchWaiting","skitchReady");var a=new RegExp("(?:"+document.body.className.replace(/\s+/,"|")+")");a.test(article.className)?handleClipperToolClick(article):a.test(clearly.className)?handleClipperToolClick(clearly):a.test(fullPage.className)?handleClipperToolClick(fullPage):a.test(pdf.className)?handleClipperToolClick(pdf):a.test(email.className)?handleClipperToolClick(email):a.test(selection.className)?handleClipperToolClick(selection):a.test(url.className)&&handleClipperToolClick(url),setHeight()}),Browser.sendToExtension({name:"getPersistentValue",key:"lastSkitchColor"}),Browser.sendToExtension({name:"getPersistentValue",key:"lastSkitchStamp"}),Browser.sendToExtension({name:"getPersistentValue",key:"isMinimized"})}function onUserChange(){if(saveEnabled=!1,previousAccount.id){var a=previousAccount.id+previousAccount.subpart;accountDataCache[a]=accountDataCache[a]||{},accountDataCache[a].selectedNotebook=notebookSelector.getSelectedNotebook(),accountDataCache[a].selectedTags=tagSelector.getTags()}var b=accountSelector.getSelectedAccount(),c=b.userInfo.userId,d=b.selectedSubpart;previousAccount.id=c,previousAccount.subpart=d;var e=c+d;accountDataCache[e]||(accountDataCache[e]={});var f={};Promise.resolve().then(function(){return platform.channel.sendMessage("getFilingInfo",{userId:c,selectedSubpart:d}).catch(function(a){return log.error(a),{}})}).then(function(a){return f=a,platform.channel.sendMessage("getSmartFilingInfo",{userId:c,selectedSubpart:d,text:recommendations.text,url:recommendations.url,pendingNoteKey:pendingNoteKey}).catch(function(a){return log.error(a),{}})}).then(function(a){return a.info&&(f.smartNotebook=a.info.smartNotebook,f.smartTags=a.info.smartTags),refreshNotebooks(b,f,!0)}).then(function(){return platform.channel.sendMessage("getTags",{userId:c,selectedSubpart:d})}).then(function(a){tagSelector.setTags(a),accountDataCache[e].selectedTags&&accountDataCache[e].selectedTags.length?tagSelector.selectTags(accountDataCache[e].selectedTags):f.alwaysTags&&f.alwaysTags.length>0?tagSelector.selectTags(f.alwaysTags):f.smartTags&&f.smartTags.length>0&&tagSelector.selectTags(f.smartTags),updateTagsInput()}).catch(function(a){log.error("OnUserChange error"),log.error(a),saveEnabled=!0})}function updateTagsInput(){notebookSelector.getSelectedNotebook().type===GlobalUtils.NOTEBOOK_TYPE_LINKED?tagSelector.disableTagInputForLinkedNb():tagSelector.enableTagInput()}function isCurrentAccount(a,b){var c=accountSelector.getSelectedAccount();return c.userInfo.userId===a&&c.selectedSubpart===b}function refreshNotebooks(a,b,c){var d=a.userInfo.userId+a.selectedSubpart;return platform.channel.sendMessage("getNotebooks",{userId:a.userInfo.userId,selectedSubpart:a.selectedSubpart,cached:c}).catch(function(a){return a.reload?refreshUI():notebookSelector.showError(a.exception),null}).then(function(c){if(c){var e=a.selectedSubpart===GlobalUtils.ACCOUNT_TYPE_PERSONAL?c.personal:c.business;(a.selectedSubpart===GlobalUtils.ACCOUNT_TYPE_PERSONAL||a.userInfo.isOnlyBusiness)&&(e=e.concat(c.linked)),e&&e.length&&(saveEnabled=!0),notebookSelector.setNotebooks(e);var f=null;accountDataCache[d].selectedNotebook&&accountDataCache[d].selectedNotebook.guid?notebookSelector.selectNotebook(accountDataCache[d].selectedNotebook.guid):b.preferredNotebook?(accountDataCache[d].preferredNotebook=e.find(function(a){return a.guid===b.preferredNotebook}),f=accountDataCache[d].preferredNotebook):b.smartNotebook&&(accountDataCache[d].smartNotebook=e.find(function(a){return a.guid===b.smartNotebook.guid}),f=accountDataCache[d].smartNotebook),!f||document.body.classList.contains("email")&&(f.published||f.shared)||notebookSelector.selectNotebook(f.guid),updateTagsInput()}})}function performSignIn(a,b,c){platform.channel.sendMessage("openSignIn",{userId:a,subpart:b,businessSSO:c}).then(function(d){d.success?(accountSelector.updateAccountTier(a,d.userInfo),(c||b!==GlobalUtils.ACCOUNT_TYPE_BUSINESS||d.isAuthenticatedBiz)&&accountSelector.selectItem({selectedAccountId:a,selectedSubpart:b})):accountSelector.selectFirstLoggedIn()})}function calcBodyWidth(){var a=154;/hidable/.test(document.body.className)&&(a=172);var b=0,c=document.querySelector(".tooltipon:first-child");if(c){var d=parseInt(window.getComputedStyle(c,":before").width)+23;b=d-25}if(c=document.querySelector(".tooltipon:last-child")){var d=parseInt(window.getComputedStyle(c,":before").width)+23;b=Math.max(d-78,0)}return document.querySelector(".subtool_panel.visible")?Math.max(a+b,330):a+b}function toggleMinimizeButtonVisibility(a){minimizeButton.classList.toggle("hide","hide"===a)}function handleClipperToolClick(a,b){if(activeClipType!==a||b)switch(activeClipType&&activeClipType.classList.remove("active"),activeClipType=a,activeClipType.classList.add("active"),"screenshot"===a.id?(toggleMinimizeButtonVisibility("hide"),toggleMinimizeButtonVisibility("hide")):toggleMinimizeButtonVisibility("show"),a.id){case"article":var c=document.body.classList.contains("remember");c||Browser.sendToExtension({name:"setPersistentValue",key:"lastUsedAction",value:"ARTICLE"}),Browser.sendToExtension({name:"bounce",message:{name:"previewArticle",scrollToElement:!c}});break;case"clearly":Browser.sendToExtension({name:"setPersistentValue",key:"lastUsedAction",value:"CLEARLY"}),Browser.sendToExtension({name:"bounce",message:{name:"previewClearly"}});break;case"custom":Browser.sendToExtension({name:"bounce",message:{name:"previewCustom"}});break;case"fullPage":Browser.sendToExtension({name:"setPersistentValue",key:"lastUsedAction",value:"FULL_PAGE"}),Browser.sendToExtension({name:"bounce",message:{name:"previewFullPage"}});break;case"pdf":Browser.sendToExtension({name:"bounce",message:{name:"previewPdf"}});break;case"url":Browser.sendToExtension({name:"setPersistentValue",key:"lastUsedAction",value:"URL"}),Browser.sendToExtension({name:"bounce",message:{name:"previewUrl"}});break;case"screenshot":document.body.classList.contains("skitchReady")?Browser.sendToExtension({name:"bounce",message:{name:"clearPreview"}}):(document.body.classList.add("skitchWaiting"),Browser.sendToExtension({name:"bounce",message:{name:"previewSkitch"}}),setHeight());break;case"email":Browser.sendToExtension({name:"bounce",message:{name:"previewEmail"}});break;case"selection":Browser.sendToExtension({name:"bounce",message:{name:"previewSelection"}})}}function handleEscape(a,b,c){document.activeElement===title?title.blur():notebookSelector.close()||tagSelector.abort()||(document.activeElement===comments?comments.blur():Browser.sendToExtension({name:"bounce",message:{name:"duplicateKeyboardShortcut",keycode:a.keycode}})),c&&"function"==typeof c&&c()}function handleSkitchToolClick(a){if("colors"!==this.id&&"zoomin"!==this.id&&"zoomout"!==this.id&&"crop"!==this.id){var b=document.getElementsByClassName("selectedSkitchTool")[0];b&&b.classList.remove("selectedSkitchTool"),this.classList.add("selectedSkitchTool")}"shapes"===this.id||"stamps"===this.id?Browser.sendToExtension({name:"bounce",message:{name:"skitch_useTool",tool:this.getAttribute("data-tool")}}):"zoomin"===this.id?Browser.sendToExtension({name:"bounce",message:{name:"skitch_zoomIn"}}):"zoomout"===this.id?Browser.sendToExtension({name:"bounce",message:{name:"skitch_zoomOut"}}):"colors"!==this.id&&(Browser.sendToExtension({name:"bounce",message:{name:"skitch_useTool",charCode:a?a.charCode:null,loc:a?a.loc:null,tool:this.id}}),"highlighter"===this.id&&Browser.sendToExtension({name:"getPersistentValue",key:"changedHighlighterColor"}));var c=document.querySelector(".subtools.open");c&&c.classList.remove("open"),(a&&!a.noOpenSubtools||!a)&&this.classList.contains("expandable")&&window[this.id+"Subtools"].classList.add("open"),handleSkitchTool=!0}function handleSubtoolClick(){SHAPE_NAMES.indexOf(this.id)>-1?(DOMTokenList.prototype.remove.apply(shapesTool.classList,SHAPE_NAMES),shapesTool.classList.add(this.id),shapesTool.setAttribute("data-tool",this.id),shapesSubtools.classList.remove("open")):STAMP_NAMES.indexOf(this.id)>-1?(DOMTokenList.prototype.remove.apply(stampsTool.classList,STAMP_NAMES),stampsTool.classList.add(this.id),stampsTool.setAttribute("data-tool",this.id),Browser.sendToExtension({name:"setPersistentValue",key:"lastSkitchStamp",value:this.id}),stampsSubtools.classList.remove("open")):COLOR_NAMES.indexOf(this.id)>-1&&(DOMTokenList.prototype.remove.apply(colorsTool.classList,COLOR_NAMES),colorsTool.classList.add(this.id),colorsTool.setAttribute("data-tool",this.id),Browser.sendToExtension({name:"setPersistentValue",key:"lastSkitchColor",value:this.id}),colorsSubtools.classList.remove("open"),Browser.sendToExtension({name:"bounce",message:{name:"skitch_useColor",color:this.id}}),"highlighter"===document.getElementsByClassName("selectedSkitchTool")[0].id&&Browser.sendToExtension({name:"setPersistentValue",key:"changedHighlighterColor",value:!0})),COLOR_NAMES.indexOf(this.id)<0&&Browser.sendToExtension({name:"bounce",message:{name:"skitch_useTool",tool:this.id}})}function openNotebook(a,b,c){notebookSelector.open(),c&&"function"==typeof c&&c()}function openTags(a,b,c){tagSelector.focus(),c&&"function"==typeof c&&c()}function reactivateClipperTool(a,b,c){requestAccounts(),handleClipperToolClick(activeClipType,!0),c&&"function"==typeof c&&c()}function receivePersistentValue(a,b,c){"isMinimized"===a.key?a.value&&"true"==a.value&&toggleMinimizeClipper():"lastSkitchStamp"===a.key?(a.value||(a.value="stampAccept"),stampsTool.classList.add(a.value),stampsTool.setAttribute("data-tool",a.value)):"lastSkitchColor"===a.key?(a.value||(a.value="pink"),colorsTool.classList.add(a.value),colorsTool.setAttribute("data-tool",a.value)):"changedHighlighterColor"===a.key&&(a.value?Browser.sendToExtension({name:"bounce",message:{name:"skitch_useColor",color:colorsTool.getAttribute("data-tool")}}):handleSubtoolClick.call(document.getElementById("yellow"))),c&&"function"==typeof c&&c()}function save(a,b,c){if(saveEnabled){saveEnabled=!1;var d=accountSelector.getSelectedAccount(),e=d.userInfo.userId+d.selectedSubpart,f=notebookSelector.getSelectedNotebook(),g=!1;accountDataCache[e].smartNotebook&&f.guid!==accountDataCache[e].smartNotebook.guid&&(g={from:{type:accountDataCache[e].smartNotebook.type},to:{defaultNotebook:f.defaultNotebook,recentNotebook:accountDataCache[e].preferredNotebook&&accountDataCache[e].preferredNotebook.guid===f.guid,type:f.type}}),platform.channel.sendMessage("setSelectedAccount",{selectedAccount:d.userInfo.userId,selectedSubpart:d.selectedSubpart}).then(function(){Browser.sendToExtension({name:"bounce",message:{name:"startSubmission",clipType:activeClipType.id,title:title.value,notebook:f,tags:tagSelector.getTags(),comment:comments.value,changedSmartFilingNotebook:g,smartFilingNotebookAvailable:!!accountDataCache[e].smartNotebook,userSelectedNotebook:!0,selectedAccount:d.userInfo.userId,selectedSubpart:d.selectedSubpart}})}),c&&"function"==typeof c&&c()}}function toggleMinimizeClipper(a,b,c){if(!0===minimizeEnable){main.classList.toggle("minified"),minimizeButton.classList.toggle("maximiseSidebar"),setHeight();var d="";main.classList.contains("minified")?(Browser.sendToExtension({name:"setPersistentValue",key:"isMinimized",value:"true"}),d="minimize_panel"):(Browser.sendToExtension({name:"setPersistentValue",key:"isMinimized",value:"false"}),d="maximize_panel"),Browser.sendToExtension({name:"trackEvent",category:"panel",action:d})}c&&"function"==typeof c&&c()}function maximizeClipper(a,b,c){main.classList.contains("minified")&&toggleMinimizeClipper(),c&&"function"==typeof c&&c()}function setHeight(a){var b=main.offsetHeight,c=(main.offsetHeight-main.clientHeight)/2,d=notebookSelector?notebookSelector.height-(b-notebook.offsetTop-c):0,e=tagSelector?tagSelector.height-(b-tags.offsetTop-c):0;void 0!==a&&null!==a||(a=!1),Browser.sendToExtension({name:"bounce",message:{name:"setGlobalToolsHeight",height:b+Math.max(Math.max(d,e),0),recalculate:a}})}function generateUseClipTypeFunctionForShortcut(a){return function(){useClipType({clipType:a})}}function generateUseSkitchToolFunctionForShortcut(a){return function(){maximizeClipper(),useSkitchTool(a)}}function generateGeneralFunctionForShortcut(a){return function(){maximizeClipper(),a()}}function setKeyboardHandlers(a,b,c){if(shortcutsEnabled=a.enabled,a.handlers){var d={};for(var e in a.handlers)for(var f=0;f<a.handlers[e].length;f++)switch(["expandArticleShortcut","contractArticleShortcut","moveArticleUpShortcut","moveArticleDownShortcut"].indexOf(e)>-1?d[a.handlers[e][f]]=function(a,b){"function"==typeof shortcutHandlers[a]&&["INPUT","TEXTAREA"].indexOf(b.nodeName)<0&&"true"!==b.contentEditable&&shortcutHandlers[a](a,b)}:d[a.handlers[e][f]]=function(a,b){shortcutsEnabled&&"function"==typeof shortcutHandlers[a]&&["INPUT","TEXTAREA"].indexOf(b.nodeName)<0&&"true"!==b.contentEditable&&shortcutHandlers[a](a,b)},e){case"closeWebClipperShortcut":shortcutHandlers[a.handlers[e][f]]=function(a){handleEscape({keycode:a})},d[a.handlers[e][f]]=function(a,b){"function"==typeof shortcutHandlers[a]&&shortcutHandlers[a](a,b)};break;case"toggleAccountShortcut":shortcutHandlers[a.handlers[e][f]]=toggleAccount;break;case"previewArticleShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("article");break;case"previewFullPageShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("fullPage");break;case"previewUrlShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("url");break;case"selectionModeShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("selection");break;case"takeScreenshotShortcut":EDGE||(shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("screenshot"));break;case"clearlyShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("clearly");break;case"pdfShortcut":EDGE||(shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("pdf"));break;case"emailShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseClipTypeFunctionForShortcut("email");break;case"selectNotebookShortcut":shortcutHandlers[a.handlers[e][f]]=generateGeneralFunctionForShortcut(openNotebook);break;case"addTagsShortcut":shortcutHandlers[a.handlers[e][f]]=generateGeneralFunctionForShortcut(openTags);break;case"saveShortcut":shortcutHandlers[a.handlers[e][f]]=function(){""!==notebookSelector.getCreateNewNotebookValue()?notebookSelector.saveNewNotebook():document.body.classList.contains("skitchWaiting")?Browser.sendToExtension({name:"bounce",message:{name:"captureScreen"}}):save()};break;case"minimizeClipperShortcut":shortcutHandlers[a.handlers[e][f]]=toggleMinimizeClipper;break;case"arrowShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"shapes",subtool:"arrow"});break;case"textShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"text"});break;case"rectangleShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"shapes",subtool:"rectangle"});break;case"roundedRectangleShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"shapes",subtool:"roundedRectangle"});break;case"ellipseShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"shapes",subtool:"ellipse"});break;case"lineShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"shapes",subtool:"line"});break;case"markerShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"marker"});break;case"highlighterShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"highlighter"});break;case"stampShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"stamps"});break;case"pixelateShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"pixelate"});break;case"cropShortcut":shortcutHandlers[a.handlers[e][f]]=generateUseSkitchToolFunctionForShortcut({tool:"crop"});break;default:shortcutHandlers[a.handlers[e][f]]=function(a){Browser.sendToExtension({name:"bounce",message:{name:"duplicateKeyboardShortcut",keycode:a}})}}Browser.addKeyboardHandlers(d)}c&&"function"==typeof c&&c()}function refreshUI(a,b,c){requestAccounts(),c&&"function"==typeof c&&c()}function setPossibleClipTypes(a,b,c){a.pageInfo.pdf?document.body.classList.add("pdf"):a.pageInfo.gmailThread?document.body.classList.add("email"):a.pageInfo.documentIsFrameset?document.body.classList.add("frameset"):a.pageInfo.custom?(document.body.classList.add("custom"),custom.textContent=Browser.i18n.getMessage(a.pageInfo.custom)):document.body.classList.add("html"),a.pageInfo.selection&&document.body.classList.add("selection"),a.rememberButton&&document.body.classList.add("remember"),setHeight(),c&&"function"==typeof c&&c()}function skitchSurfaceReady(a,b,c){toggleMinimizeButtonVisibility("show"),document.body.classList.add("skitchReady"),handleSkitchToolClick.call(shapesTool,{noOpenSubtools:!0}),Browser.sendToExtension({name:"bounce",message:{name:"skitch_useColor",color:colorsTool.getAttribute("data-tool")}}),setHeight(),c&&"function"==typeof c&&c()}function createNotebook(a){a.personalNotebook=accountSelector.getSelectedAccount().selectedSubpart===GlobalUtils.ACCOUNT_TYPE_PERSONAL;var b=accountSelector.getSelectedAccount();platform.channel.sendMessage("createNotebook",{notebook:a}).then(function(a){Browser.sendToExtension({name:"trackEvent",category:"notebooks",action:"create_notebook",label:a.businessId?"business":"personal"}),notebookSelector.appendNotebook(a),notebookSelector.selectNotebook(a.guid),notebookSelector.closeNewNotebookBlock(),notebookSelector.close()}).then(function(){platform.channel.sendMessage("getNotebooks",{userId:b.userInfo.userId,selectedSubpart:b.selectedSubpart,cached:!1})}).catch(function(a){notebookSelector.closeNewNotebookBlock(),notebookSelector.showError(a)}).then(setHeight.bind(this))}function useClipType(a,b,c){if(!document.body.classList.contains("skitchReady")){new RegExp("(?:"+document.body.className.replace(/\s+/,"|")+")").test(window[a.clipType].className)&&(maximizeClipper(),handleClipperToolClick(window[a.clipType]))}c&&"function"==typeof c&&c()}function toggleAccount(a,b,c){accountSelector.toggleSelectedAccount(),c&&"function"==typeof c&&c()}function useSkitchTool(a,b,c){document.body.classList.contains("skitchReady")&&(handleSkitchToolClick.call(document.getElementById(a.tool),{charCode:a.charCode,loc:a.loc,noOpenSubtools:!0}),a.subtool&&handleSubtoolClick.call(document.getElementById(a.subtool))),c&&"function"==typeof c&&c()}function setTitle(a,b,c){title.value=a.title,c&&"function"==typeof c&&c()}function getBrowserHeight(a,b,c){browserHeight=a.height||0,toggleSmallScreenMode(),c&&"function"==typeof c&&c()}function setSaveReady(a,b,c){saveEnabled=!!a.value,saveButton.classList.toggle("green",saveEnabled),saveButton.classList.toggle("gray",!saveEnabled),c&&"function"==typeof c&&c()}function toggleSmallScreenMode(a,b,c){var d=notebookSelector&&notebookSelector.isOpened(),e=main.offsetHeight;d&&!main.classList.contains("smallScreenMode")&&(dropdownHeight=main.querySelector(".nbDropdown").offsetHeight+main.querySelector(".nbDropdown").offsetTop);var f=document.getElementById("organize").offsetHeight,g=document.getElementById("organize").getElementsByTagName("h1")[0].offsetHeight,h=document.getElementById("account").offsetHeight,i=e-f-h+g+dropdownHeight,j=Math.max(e,i);main.classList.contains("smallScreenMode")?(main.classList.toggle("smallScreenMode",!1),j+clipSection.offsetHeight+20>=browserHeight&&main.classList.toggle("smallScreenMode",d)):j>=browserHeight?main.classList.toggle("smallScreenMode",d):main.classList.toggle("smallScreenMode",!1),setHeight(),c&&"function"==typeof c&&c()}var SHAPE_NAMES=["arrow","rectangle","roundedRectangle","ellipse","line"],STAMP_NAMES=["stampAccept","stampReject","stampExclaim","stampQuestion","stampPerfect"],COLOR_NAMES=["red","orange","yellow","black","green","blue","pink","white"],receivedPersonalNotebooks=!1,receivedBusinessNotebooks=!1,receivedSharedNotebooks=!1,shortcutsEnabled=!0,savedAuthInfo={},main,closeSidebar,title,saveButton,cancelScreenshotButton,article,clearly,custom,fullPage,selection,pdf,email,url,screenshot,activeClipType,accountDataCache={},notebookSelectionData={},recommendations={text:null,url:null},pendingNoteKey,previousAccount={},accountSelectorElt,accountSelector,notebook,notebookSelector,tags,tagSelector,comments,shapesTool,shapesSubtools,stampsTool,stampsSubtools,colorsTool,colorsSubtools,settings,smartFilingInfo,shortcutHandlers={},handleSkitchTool=!1,saveEnabled=!0,minimizeEnable=!0,browserHeight=0,dropdownHeight=0;Browser.addMessageHandlers({gt_handleEscape:handleEscape,gt_initialize:initData,gt_openNotebook:openNotebook,gt_openTags:openTags,gt_reactivateClipperTool:reactivateClipperTool,gt_save:save,gt_toggleMinimizeClipper:toggleMinimizeClipper,gt_maximizeClipper:maximizeClipper,gt_setKeyboardHandlers:setKeyboardHandlers,gt_setPossibleClipTypes:setPossibleClipTypes,gt_refresh:refreshUI,gt_useClipType:useClipType,gt_toggleAccount:toggleAccount,gt_useSkitchTool:useSkitchTool,gt_setSaveReady:setSaveReady,gt_setTitle:setTitle,gt_getBrowserHeight:getBrowserHeight,gt_toggleSmallScreenMode:toggleSmallScreenMode,receivePersistentValue:receivePersistentValue,skitchSurfaceReady:skitchSurfaceReady}),window.addEventListener("DOMContentLoaded",function(){main=document.getElementById("main"),closeSidebar=document.getElementById("closeSidebar"),minimizeButton=document.getElementById("minimizeButton"),title=document.getElementById("title"),saveButton=document.getElementById("saveButton"),cancelScreenshotButton=document.getElementById("cancelScreenshot"),article=document.getElementById("article"),clearly=document.getElementById("clearly"),custom=document.getElementById("custom"),fullPage=document.getElementById("fullPage"),selection=document.getElementById("selection"),pdf=document.getElementById("pdf"),email=document.getElementById("email"),url=document.getElementById("url"),screenshot=document.getElementById("screenshot"),activeClipType=null,accountSelectorElt=document.getElementById("accountSelector"),notebook=document.getElementById("notebook"),tags=document.getElementById("tags"),comments=document.getElementById("comments"),shapesTool=document.getElementById("shapes"),stampsTool=document.getElementById("stamps"),colorsTool=document.getElementById("colors"),shapesSubtools=document.getElementById("shapesSubtools"),stampsSubtools=document.getElementById("stampsSubtools"),colorsSubtools=document.getElementById("colorsSubtools"),settings=document.getElementById("settings"),previewBanner=document.getElementById("previewBanner"),clipSection=document.getElementById("clip"),Browser.setInterceptSpecialKeys(!0),Browser.sendToExtension({name:"bounce",message:{name:"getGlobalToolsData"}})});